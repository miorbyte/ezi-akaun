<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZI Akaun v7.9 | KV Kulim Innovation (Updated)</title>
    <style>
        :root {
            --primary: #4361ee;
            --success: #2ecc71;
            --danger: #e63946;
            --dark: #1e1f26;
            --light: #f8f9fa;
            --border-color: #dee2e6;
            --warning: #f39c12; /* Warna baru untuk Aset/Pinjaman */
        }
        
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: #f0f2f5; margin: 0; padding: 15px; color: #333; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Header */
        .nama-syarikat-container { text-align: center; margin-bottom: 30px; }
        .nama-syarikat-input { 
            font-size: 30px; font-weight: 800; text-align: center; color: var(--primary);
            border: 2px dashed #ced4da; background: white; padding: 12px; border-radius: 15px; 
            width: 100%; max-width: 600px; display: block; margin: 0 auto; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* Dashboard Grid */
        .grid-main { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 25px; }
        @media (min-width: 900px) { .grid-main { grid-template-columns: 1.5fr 1fr 1fr; } }

        .ai-card { 
            background: linear-gradient(135deg, var(--dark) 0%, #3a3d54 100%); 
            color: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .info-card { background: white; padding: 20px; border-radius: 20px; border: 1px solid var(--border-color); }
        .info-card-title { font-size: 13px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 8px; }

        .bar-container { background: rgba(255,255,255,0.1); border-radius: 10px; height: 10px; margin: 15px 0; }
        .bar-fill { height: 100%; border-radius: 10px; width: 0%; transition: 1.5s ease; }

        .export-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .btn-export { 
            padding: 12px; border: none; border-radius: 10px; color: white; 
            font-weight: 700; cursor: pointer; display: flex; align-items: center; 
            justify-content: center; gap: 10px; transition: 0.3s; font-size: 13px; width: 100%;
        }
        .btn-pdf { background-color: var(--danger); }
        .btn-excel { background-color: var(--success); }

        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card-title { margin: 0 0 20px 0; font-size: 17px; font-weight: 700; border-left: 5px solid var(--primary); padding-left: 15px; }

        /* Form Layout */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 13px; color: #555; }
        input, select { width: 100%; padding: 12px; border: 1.5px solid var(--border-color); border-radius: 10px; font-size: 14px; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .btn-reset { background: none; color: #ccc; border: none; font-size: 11px; margin-top: 15px; cursor: pointer; text-decoration: underline; width: 100%; }

        /* Jadual Laporan */
        .table-laporan { width: 100%; border-collapse: collapse; }
        .table-laporan td { padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .table-laporan td.val-laporan { text-align: right; font-weight: 700; }
        .total-row { background: #f9f9f9; font-weight: 800 !important; border-top: 2px solid #333; color: #333; }

        .table-history-container { overflow-x: auto; }
        .table-history { width: 100%; border-collapse: collapse; min-width: 700px; }
        .table-history th { 
            text-align: left; background: #f8f9fa; padding: 15px 12px; 
            font-weight: 700; color: #666; border-bottom: 2px solid #eee;
        }
        .table-history td { padding: 15px 12px; border-bottom: 1px solid #f0f0f0; }
        .td-amaun { font-weight: 700; text-align: right; }

        .badge { padding: 6px 12px; border-radius: 8px; font-size: 14px; font-weight: 600; background: #eee; color: #333; display: inline-block; }
        .kk-header { color: var(--primary); font-weight: 800; font-size: 14px; padding-top: 20px; text-transform: uppercase; }
        .footer-note { text-align: center; font-size: 11px; color: #999; margin: 50px 0 20px; font-weight: 500; }

        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<div class="container">
    <div class="nama-syarikat-container">
        <input type="text" id="namaSyarikat" class="nama-syarikat-input" placeholder="Masukkan Nama Perniagaan">
        <div id="tajukLaporan" style="margin-top:10px; font-weight: bold; color:var(--dark);">
            LAPORAN KEWANGAN SEHINGGA: <span id="displayTarikh">...</span>
        </div>
    </div>

    <div class="grid-main no-print">
        <div class="ai-card">
            <div style="font-size: 11px; opacity: 0.8; font-weight: 600;">STATUS PRESTASI</div>
            <div id="statusTeks" style="font-size: 22px; font-weight: 800; margin: 8px 0;">Analisis Data...</div>
            <div class="bar-container"><div id="progressBar" class="bar-fill"></div></div>
            <div id="nasihatAI" style="font-size: 12px; opacity: 0.9; line-height: 1.4; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;">
                Sila masukkan data kewangan anda.
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">Analisis Breakeven</div>
            <div style="font-size: 11px; color: #888;">Sasaran Jualan Minimum:</div>
            <div id="valBreakeven" style="font-size: 24px; font-weight: 800; color: var(--primary); margin: 5px 0;">RM 0.00</div>
            <p style="font-size: 11px; color: #666; line-height: 1.4;">Jumlah jualan untuk menampung kos operasi bulan ini.</p>
        </div>

        <div class="info-card">
            <div class="info-card-title">Export Laporan</div>
            <div class="export-grid">
                <button class="btn-export btn-pdf" onclick="window.print()"><span>ðŸ“„</span> Cetak Laporan PDF</button>
                <button class="btn-export btn-excel" onclick="simpanExcel()"><span>ðŸ“Š</span> Simpan Fail Excel</button>
            </div>
            <button class="btn-reset" onclick="resetSistem()">Reset Semua Rekod</button>
        </div>
    </div>

    <div class="card no-print">
        <h2 class="card-title">Kemasukan Transaksi</h2>
        <form id="bookkeepingForm">
            <div class="form-grid">
                <div class="form-group"><label>Kategori</label><select id="jenis" required>
                    <option value="" disabled selected>Pilih...</option>
                    <optgroup label="Duit Masuk">
                        <option value="modal">Suntikan Modal (Owner)</option>
                        <option value="jualan">Jualan Tunai</option>
                        <option value="pinjaman">Pinjaman Bank/Luar</option>
                    </optgroup>
                    <optgroup label="Duit Keluar">
                        <option value="belian">Belian Stok</option>
                        <option value="belanja">Belanja Operasi (Bil/Sewa/Gaji)</option>
                        <option value="aset">Belanja Aset (Mesin/Peralatan)</option>
                    </optgroup>
                    <optgroup label="Hutang (Kredit)">
                        <option value="jualan_hutang">Jualan Hutang (Customer Hutang)</option>
                        <option value="belian_hutang">Belian Hutang (Hutang Supplier)</option>
                    </optgroup>
                </select></div>
                <div class="form-group"><label>Tarikh</label><input type="date" id="tarikh" required onchange="kemaskiniTarikhDisplay()"></div>
            </div>
            <div class="form-grid" style="grid-template-columns: 2fr 1fr;">
                <div class="form-group"><label>Butiran</label><input type="text" id="butiran" placeholder="Contoh: Bil Elektrik / Beli Mesin Cetak" required></div>
                <div class="form-group"><label>Amaun (RM)</label><input type="number" id="amaun" step="0.01" required></div>
            </div>
            <button type="submit" class="btn-primary">Sahkan & Simpan Rekod</button>
        </form>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px;">
        <div class="card">
            <h2 class="card-title">Untung & Rugi</h2>
            <table class="table-laporan">
                <tr><td>Hasil Jualan</td><td class="val-laporan" id="valJualan" style="color:var(--success)">RM 0.00</td></tr>
                <tr><td>Kos Belian Stok</td><td class="val-laporan" id="valBelian" style="color:var(--danger)">- RM 0.00</td></tr>
                <tr style="background:#f9f9f9; font-weight:bold;"><td>Untung Kasar</td><td class="val-laporan" id="valUntungKasar">RM 0.00</td></tr>
                <tr><td>Belanja Operasi (Bil/Gaji/Sewa)</td><td class="val-laporan" id="valBelanja" style="color:var(--danger)">- RM 0.00</td></tr>
                <tr class="total-row" style="font-size:18px;"><td><b>Untung Bersih</b></td><td class="val-laporan" id="valUntungBersih">RM 0.00</td></tr>
            </table>
        </div>

        <div class="card">
            <h2 class="card-title">Kunci Kira-Kira</h2>
            <table class="table-laporan">
                <tr><td colspan="2" class="kk-header">ASET</td></tr>
                <tr><td>Tunai & Bank</td><td class="val-laporan" id="valTunai">RM 0.00</td></tr>
                <tr><td>Aset Tetap (Mesin/Peralatan)</td><td class="val-laporan" id="valAsetTetap">RM 0.00</td></tr>
                <tr><td>Penghutang (Customer)</td><td class="val-laporan" id="valPenghutang">RM 0.00</td></tr>
                <tr class="total-row"><td>JUMLAH ASET</td><td class="val-laporan" id="valJumlahAset">RM 0.00</td></tr>
                
                <tr><td colspan="2" class="kk-header">LIABILITI & EKUITI</td></tr>
                <tr><td>Hutang Pemiutang / Pinjaman</td><td class="val-laporan" id="valLiabiliti">RM 0.00</td></tr>
                <tr><td>Ekuiti Pemilik</td><td class="val-laporan" id="valEkuiti">RM 0.00</td></tr>
                <tr class="total-row"><td>JUMLAH (L+E)</td><td class="val-laporan" id="valLiabilitiEkuiti">RM 0.00</td></tr>
            </table>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">Sejarah Transaksi</h2>
        <input type="text" id="cariData" style="width:100%; padding:12px; border-radius:10px; border:1.5px solid #ddd; margin-bottom: 20px;" placeholder="Cari..." onkeyup="renderTable()">
        <div class="table-history-container">
            <table class="table-history">
                <thead>
                    <tr><th>Tarikh</th><th>Kategori</th><th>Butiran</th><th style="text-align:right">Amaun (RM)</th><th class="no-print" style="text-align:center">Aksi</th></tr>
                </thead>
                <tbody id="senaraiTransaksi"></tbody>
            </table>
        </div>
    </div>

    <div class="footer-note">Inspirasi Projek Inovasi BPP KV Kulim by team EZI Akaun v7.9 Updated</div>
</div>

<script>
    document.getElementById('tarikh').valueAsDate = new Date();
    kemaskiniTarikhDisplay();

    const inputNama = document.getElementById('namaSyarikat');
    inputNama.value = localStorage.getItem('namaSyarikat') || "";
    inputNama.addEventListener('input', () => localStorage.setItem('namaSyarikat', inputNama.value));

    let senaraiData = JSON.parse(localStorage.getItem('bookkeepingData')) || [];

    function kemaskiniTarikhDisplay() {
        document.getElementById('displayTarikh').innerText = document.getElementById('tarikh').value;
    }

    function saveAndRefresh() {
        localStorage.setItem('bookkeepingData', JSON.stringify(senaraiData));
        kiraSemua();
        renderTable();
    }

    function kiraSemua() {
        let akaun = { 
            tunai: 0, jualan: 0, belian: 0, belanja: 0, modal: 0, 
            penghutang: 0, pemiutang: 0, pinjaman: 0, asetTetap: 0 
        };

        senaraiData.forEach(d => {
            if(d.jenis === 'modal') { akaun.tunai += d.amaun; akaun.modal += d.amaun; }
            else if(d.jenis === 'jualan') { akaun.tunai += d.amaun; akaun.jualan += d.amaun; }
            else if(d.jenis === 'pinjaman') { akaun.tunai += d.amaun; akaun.pinjaman += d.amaun; }
            else if(d.jenis === 'belian') { akaun.tunai -= d.amaun; akaun.belian += d.amaun; }
            else if(d.jenis === 'belanja') { akaun.tunai -= d.amaun; akaun.belanja += d.amaun; }
            else if(d.jenis === 'aset') { akaun.tunai -= d.amaun; akaun.asetTetap += d.amaun; }
            else if(d.jenis === 'jualan_hutang') { akaun.penghutang += d.amaun; akaun.jualan += d.amaun; }
            else if(d.jenis === 'belian_hutang') { akaun.pemiutang += d.amaun; akaun.belian += d.amaun; }
        });
        updateUI(akaun);
    }

    function updateUI(akaun) {
        const fmt = (n) => "RM " + n.toLocaleString('en-US', {minimumFractionDigits: 2});
        let uk = akaun.jualan - akaun.belian;
        let ub = uk - akaun.belanja;
        let ja = akaun.tunai + akaun.penghutang + akaun.asetTetap;
        let ep = akaun.modal + ub;
        let jl = akaun.pemiutang + akaun.pinjaman; // Total Hutang
        let jle = jl + ep; // Balancing check
        
        document.getElementById('valJualan').innerText = fmt(akaun.jualan);
        document.getElementById('valBelian').innerText = "- " + fmt(akaun.belian);
        document.getElementById('valUntungKasar').innerText = fmt(uk);
        document.getElementById('valBelanja').innerText = "- " + fmt(akaun.belanja);
        document.getElementById('valUntungBersih').innerText = fmt(ub);
        
        document.getElementById('valTunai').innerText = fmt(akaun.tunai);
        document.getElementById('valAsetTetap').innerText = fmt(akaun.asetTetap);
        document.getElementById('valPenghutang').innerText = fmt(akaun.penghutang);
        document.getElementById('valJumlahAset').innerText = fmt(ja);
        
        document.getElementById('valLiabiliti').innerText = fmt(jl);
        document.getElementById('valEkuiti').innerText = fmt(ep);
        document.getElementById('valLiabilitiEkuiti').innerText = fmt(jle);

        document.getElementById('valBreakeven').innerText = fmt(akaun.belian + akaun.belanja);
        let pb = akaun.jualan > 0 ? (akaun.belanja / akaun.jualan) * 100 : 0;
        document.getElementById('progressBar').style.width = Math.min(pb, 100) + "%";
        
        let st = document.getElementById('statusTeks');
        let na = document.getElementById('nasihatAI');
        if(ub >= 0) {
            st.innerText = "Bisnes Sihat âœ…"; st.style.color = "var(--success)";
            na.innerText = "Sangat Bagus! Untung bersih anda mencukupi.";
        } else {
            st.innerText = "Zon Bahaya âš ï¸"; st.style.color = "var(--danger)";
            na.innerText = "Peringatan: Belanja melebihi untung kasar.";
        }
    }

    function renderTable() {
        const tbody = document.getElementById('senaraiTransaksi');
        const filter = document.getElementById('cariData').value.toLowerCase();
        tbody.innerHTML = "";
        senaraiData.filter(d => d.butiran.toLowerCase().includes(filter)).reverse().forEach(d => {
            let row = `<tr>
                <td>${d.tarikh}</td>
                <td><span class="badge">${d.jenis.replace('_', ' ').toUpperCase()}</span></td>
                <td>${d.butiran}</td>
                <td class="td-amaun">RM ${d.amaun.toFixed(2)}</td>
                <td class="no-print" style="text-align:center"><button style="color:red; border:1px solid red; background:none; cursor:pointer; padding:3px 6px; border-radius:4px;" onclick="padamRekod(${d.id})">Padam</button></td>
            </tr>`;
            tbody.insertAdjacentHTML('beforeend', row);
        });
    }

    document.getElementById('bookkeepingForm').addEventListener('submit', function(e) {
        e.preventDefault();
        senaraiData.push({
            id: Date.now(),
            jenis: document.getElementById('jenis').value,
            tarikh: document.getElementById('tarikh').value,
            butiran: document.getElementById('butiran').value,
            amaun: parseFloat(document.getElementById('amaun').value)
        });
        saveAndRefresh();
        this.reset();
        document.getElementById('tarikh').valueAsDate = new Date();
        kemaskiniTarikhDisplay();
    });

    function padamRekod(id) { if(confirm("Hapus?")) { senaraiData = senaraiData.filter(d => d.id !== id); saveAndRefresh(); } }
    function resetSistem() { if(confirm("Hapus semua data?")) { senaraiData = []; saveAndRefresh(); } }
    function simpanExcel() {
        let content = `<html><head><meta charset="UTF-8"></head><body><h2>EZI Akaun</h2><table border="1">${document.querySelector('.table-history').innerHTML}</table></body></html>`;
        let blob = new Blob([content], {type: 'application/vnd.ms-excel'});
        let a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'Laporan.xls';
        a.click();
    }

    kiraSemua();
    renderTable();
</script>
</body>
</html>
